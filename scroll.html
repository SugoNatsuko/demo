<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floating Button Sample</title>

<style>
  body {
    margin: 0;
    font-family: sans-serif;
    line-height: 1.6;
  }

  .page {
    position: relative; /* absoluteの基準 */
    padding: 20px;
  }

  .section {
    height: 800px;
    background: #f5f5f5;
    margin-bottom: 20px;
    padding: 20px;
  }

  footer {
    background: #333;
    color: #fff;
    padding: 80px 20px;
    text-align: center;
  }

  /* フローティングボタン */
  .fab {
    position: fixed;
    left: 16px;
    right: 16px;
    bottom: calc(16px + env(safe-area-inset-bottom));
    height: 56px;
    border-radius: 999px;
    background: #ff6600;
    color: #fff;
    border: none;
    font-size: 16px;
    cursor: pointer;
    z-index: 1000;

    /* 初期非表示 */
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: 0.3s;
  }

  .fab.is-visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  /* フッターが見えたらコンテンツ内に固定 */
  .fab.is-docked {
    position: absolute;
    bottom: calc(100% + 16px);
  }
</style>
</head>

<body>

<main class="page">
  <div class="section">スクロールしてください（セクション1）</div>
  <div class="section">スクロールしてください（セクション2）</div>

  <button class="fab" id="fab">お問い合わせ</button>

  <footer id="footer">
    フッターエリア
  </footer>
</main>

<script>
  const fab = document.getElementById("fab");
  const footer = document.getElementById("footer");

  // ① 少しスクロールしたら表示
  const showAfter = 150;

  function handleScroll() {
    if (window.scrollY > showAfter) {
      fab.classList.add("is-visible");
    } else {
      fab.classList.remove("is-visible");
    }
  }

  window.addEventListener("scroll", handleScroll, { passive: true });
  handleScroll();

  // ② フッターが見えたらドッキング
  const observer = new IntersectionObserver(
    (entries) => {
      if (entries[0].isIntersecting) {
        fab.classList.add("is-docked");
      } else {
        fab.classList.remove("is-docked");
      }
    },
    { threshold: 0 }
  );

  observer.observe(footer);
</script>

</body>
</html>